#####Java 虚拟机具体是怎样运行 Java 字节码的？

从虚拟机视角来看，执行 Java 代码首先需要将它编译而成的 class 文件加载到 Java 虚拟机中。加
载后的 Java 类会被存放于方法区（Method Area）中。实际运行时，虚拟机会执行方法区内的代
码。
如果你熟悉 X86 的话，你会发现这和段式内存管理中的代码段类似。而且，Java 虚拟机同样也在
内存中划分出堆和栈来存储运行时数据。
不同的是，Java 虚拟机会将栈细分为面向 Java 方法的 Java 方法栈，面向本地方法（用 C++ 写的
native 方法）的本地方法栈，以及存放各个线程执行位置的 PC 寄存器。

![](https://github.com/hailin1994/learn/blob/master/jvm/img/jvm内存模型.png)在运行过程中，每当调用进入一个 Java 方法，Java 虚拟机会在当前线程的 Java 方法栈中生成一个

栈帧，用以存放局部变量以及字节码的操作数。这个栈帧的大小是提前计算好的，而且 Java 虚拟机
不要求栈帧在内存空间里连续分布。
当退出当前执行的方法时，不管是正常返回还是异常返回，Java 虚拟机均会弹出当前线程的当前栈
帧，并将之舍弃。

从硬件视角来看，Java 字节码无法直接执行。因此，Java 虚拟机需要将字节码翻译成机器码。
在 HotSpot 里面，上述翻译过程有两种形式：第一种是解释执行，即逐条将字节码翻译成机器码并
执行；第二种是即时编译（Just-In-Time compilation，JIT），即将一个方法中包含的所有字节码编
译成机器码后再执行。

![](https://github.com/hailin1994/learn/blob/master/jvm/img/jvm硬件模型.png)

前者的优势在于无需等待编译，而后者的优势在于实际运行速度更快。HotSpot 默认采用混合模
式，综合了解释执行和即时编译两者的优点。它会先解释执行字节码，而后将其中反复执行的热点
代码，以方法为单位进行即时编译。

为了提高运行效率，标准 JDK 中的 HotSpot 虚拟机采用的是一种混合执行的策略。